<title>WaveGroupYT â€” Login/Register</title>

<style>
  .center-wrapper {
    min-height: 80vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .box {
    background: white;
    border-radius: 14px;
    padding: 32px 24px;
    width: 340px;
    border: 1px solid #e5e7eb;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 20px;
  }

  h2 {
    margin-bottom: 16px;
    font-size: 20px;
    color: #111827;
  }

  p {
    font-size: 14px;
    color: #4b5563;
    margin-bottom: 16px;
  }

  input, button {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    font-size: 15px;
    box-sizing: border-box;
  }

  input {
    border: 1px solid #e5e7eb;
    outline: none;
    margin-bottom: 12px;
  }

  input::placeholder {
    color: #94a3b8;
  }

  button {
    border: none;
    background: #2563eb;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }

  button:hover {
    background: #1e40af;
  }

  .msg {
    margin-top: 12px;
    font-size: 14px;
    color: #2563eb;
  }

  .status-box {
    background: #f9fafb;
    border-radius: 10px;
    padding: 20px;
    width: 340px;
    border: 1px solid #e5e7eb;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }

  .status {
    font-weight: 600;
    color: #111827;
    font-size: 16px;
    margin-bottom: 10px;
  }

  .waiting {
    color: #d97706;
  }

  .approved {
    color: #16a34a;
  }
</style>

<div class="center-wrapper">
  <div class="box">
    <h2>WaveGroupYT Login</h2>
    <p>Enter your YouTube channel handle to access your member dashboard.</p>
    <input id="channelHandle" placeholder="@yourchannel" />
    <button onclick="handleSubmit()">Join Group</button>
    <div class="msg" id="msg">
      <p>Please enter a valid YouTube channel handle.</p>
    </div>
  </div>

  <!-- âœ… Status Section -->
  <div id="statusSection" class="status-box" style="display:none;">
    <div id="statusText" class="status"></div>
    <div id="statusMessage"></div>
    <div id="countdown"></div>
  </div>
</div>

<script>
const CHECK_MEMBER_URL = "https://script.google.com/macros/s/AKfycbx-ZqFKWRfis9J5ERQ3Li5iRP6Qbd-R7iR9jZ3uaj8-NpSdIhdPyoROFEMWxRX4Tk3x-g/exec";
const REQUEST_JOIN_URL = "https://script.google.com/macros/s/AKfycbzrIuVgUIsj0Z0X_2SldGbvYBv6K-MA5BDHGSkLbRGKGNqXG7R04CaZeWciDSvBT9oP/exec";
const REDIRECT_URL = "https://youtubewatchtimegroup.blogspot.com/p/start-work-on-youtube-watchtime-group.html";
const PROFILE_URL = "https://youtubewatchtimegroup.blogspot.com/p/user-profile.html"; // <-- change this to your User Profile page

async function handleSubmit() {
  const msg = document.getElementById("msg");
  const btn = document.querySelector("button");
  const input = document.getElementById("channelHandle");

  let handle = input.value.trim();
  if (!handle) {
    msg.textContent = "Please enter a valid handle (e.g. @ekanogaming)";
    return;
  }
  if (!handle.startsWith("@")) handle = "@" + handle;

  msg.textContent = "Checking membership...";
  btn.disabled = true;

  try {
    const resp = await fetch(`${CHECK_MEMBER_URL}?handle=${encodeURIComponent(handle)}`);
    const data = await resp.json();

    if (data.exists) {
      msg.textContent = "Member found!";
      localStorage.setItem("channelHandle", handle);
      
      // ðŸ”„ Send the handle to Chrome extension
window.postMessage({ type: "SET_CHANNEL_HANDLE", handle }, "*");
      
      showStatus(handle);
    } else {
      msg.textContent = "Sending join request...";
      await fetch(REQUEST_JOIN_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "handle=" + encodeURIComponent(handle)
      });
      localStorage.setItem("channelHandle", handle);
      
      // ðŸ”„ Send the handle to Chrome extension
window.postMessage({ type: "SET_CHANNEL_HANDLE", handle }, "*");
      
      msg.textContent = "Request sent! Please wait for admin approval.";
      showStatus(handle);
    }
  } catch (err) {
    msg.textContent = "âŒ Error: " + err.message;
  } finally {
    btn.disabled = false;
  }
}

// âœ… Load saved handle on page load
document.addEventListener("DOMContentLoaded", async () => {
  const input = document.getElementById("channelHandle");
  const savedHandle = localStorage.getItem("channelHandle");
  if (savedHandle) {
    input.value = savedHandle;
    showStatus(savedHandle);
  }
});

// âœ… Fetch and display status box
async function showStatus(handle) {
  const statusSection = document.getElementById("statusSection");
  const statusText = document.getElementById("statusText");
  const statusMessage = document.getElementById("statusMessage");
  const countdownEl = document.getElementById("countdown");

  statusSection.style.display = "block";
  statusText.textContent = "Checking status...";
  statusText.className = "status";

  try {
    const resp = await fetch(`${REQUEST_JOIN_URL}?handle=${encodeURIComponent(handle)}`);
    const data = await resp.json();

    if (!data.exists) {
      statusText.textContent = "Not Found";
      statusMessage.textContent = "You are not registered yet. Please join the group.";
      return;
    }

    const status = data.status?.trim() || "Waiting";

    if (status === "Approved") {
      statusText.textContent = "Approved ";
      statusText.classList.add("approved");
      statusMessage.textContent = "Your account has been approved! Now You can start your work";

      let remaining = 5;
      countdownEl.textContent = `Redirecting in ${remaining}s...`;

      const timer = setInterval(() => {
        remaining--;
        countdownEl.textContent = `Redirecting in ${remaining}s...`;
        if (remaining <= 0) {
          clearInterval(timer);
          window.location.href = PROFILE_URL;
        }
      }, 1000);
    } else {
      statusText.textContent = "Waiting";
      statusText.classList.add("waiting");
      statusMessage.textContent = "Please wait while the admin sets up your account. Within 24 hours we will setup your account and playlist";
    }
  } catch (err) {
    statusText.textContent = "Error âŒ";
    statusMessage.textContent = err.message;
  }
}
</script>
